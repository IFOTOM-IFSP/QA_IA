<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>IFOTOM QA – Cuvette Segmentation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <style>
      :root {
        /* Paleta IFOTOM (light) */
        --brand-primary: #9d4edd;
        --brand-secondary: #6a0dad;
        --brand-light: #cba6e8;
        --brand-bg-light: #f4ecf5;

        --success-main: #28a745;
        --warning-main: #ffc107;
        --danger-main: #dc3545;

        --neutral-bg: #faf6fd;
        --neutral-card: #ffffff;
        --neutral-border: rgba(0, 0, 0, 0.08);
        --neutral-text: #1e1e1e;
        --neutral-text-secondary: #6b6b6b;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: var(--neutral-bg);
        color: var(--neutral-text);
        min-height: 100vh;
      }

      header {
        background: #ffffff;
        border-bottom: 1px solid rgba(0, 0, 0, 0.06);
      }

      .header-inner {
        max-width: 1120px;
        margin: 0 auto;
        padding: 10px 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .logo-pill {
        width: 32px;
        height: 32px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 30%, #ffffff, #f4ecf5 40%, #9d4edd 95%);
        border: 1px solid rgba(0, 0, 0, 0.12);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.72rem;
        font-weight: 700;
        color: #1e1e1e;
      }

      .header-title {
        font-size: 1.02rem;
        font-weight: 600;
      }

      .header-subtitle {
        font-size: 0.8rem;
        color: var(--neutral-text-secondary);
      }

      .header-badge {
        font-size: 0.72rem;
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid rgba(157, 78, 221, 0.25);
        color: #4b1580;
        background-color: #f7efff;
        white-space: nowrap;
      }

      main {
        max-width: 1120px;
        margin: 0 auto;
        padding: 20px 16px 24px;
      }

      .layout {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
      }

      @media (min-width: 900px) {
        .layout {
          grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
          align-items: flex-start;
        }
      }

      .card {
        background: var(--neutral-card);
        border-radius: 16px;
        border: 1px solid var(--neutral-border);
        padding: 20px 20px 18px;
        box-shadow: 0 4px 14px rgba(15, 23, 42, 0.05);
      }

      .card h2 {
        font-size: 1rem;
        margin: 0 0 6px;
      }

      .card p {
        font-size: 0.84rem;
        color: var(--neutral-text-secondary);
        margin: 0 0 12px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .file-drop {
        border-radius: 12px;
        padding: 18px 16px;
        min-height: 110px;
        text-align: center;
        cursor: pointer;
        border: 1px dashed rgba(157, 78, 221, 0.5);
        background: #faf5ff;
        transition: border-color 0.15s ease, background 0.15s ease;
      }

      .file-drop:hover {
        border-color: var(--brand-primary);
        background: #f3e6ff;
      }

      .file-drop span {
        display: block;
      }

      .file-drop .title {
        font-size: 0.9rem;
        font-weight: 500;
        color: #2d114f;
      }

      .file-drop .hint {
        font-size: 0.78rem;
        color: var(--neutral-text-secondary);
        margin-top: 4px;
      }

      input[type="file"] {
        display: none;
      }

      .selected-file {
        font-size: 0.8rem;
        color: var(--neutral-text-secondary);
        min-height: 1.2em;
      }

      .btn {
        margin-top: 10px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 10px 18px;
        border-radius: 999px;
        border: none;
        font-size: 0.88rem;
        font-weight: 500;
        color: #ffffff;
        background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(157, 78, 221, 0.35);
        transition: transform 0.08s ease, box-shadow 0.1s ease;
        width: 100%;
      }

      @media (min-width: 600px) {
        .btn {
          width: auto;
          min-width: 220px;
        }
      }

      .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 7px 16px rgba(157, 78, 221, 0.4);
      }

      .btn:active {
        transform: translateY(0);
        box-shadow: 0 3px 8px rgba(157, 78, 221, 0.3);
      }

      .error-box {
        margin-top: 10px;
        font-size: 0.8rem;
        color: #721c24;
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        border-radius: 8px;
        padding: 8px 10px;
      }

      .result-header {
        font-size: 0.8rem;
        color: var(--neutral-text-secondary);
        margin-bottom: 8px;
      }

      .result-header strong {
        color: #2b133f;
      }

      .qa-summary {
        border-radius: 12px;
        padding: 10px 12px;
        margin-bottom: 10px;
        border-left: 4px solid transparent;
        font-size: 0.84rem;
      }

      .qa-summary-title {
        font-weight: 600;
        margin-bottom: 4px;
      }

      .qa-summary--ok {
        background: #e8f5e9;
        border-color: var(--success-main);
        color: #155724;
      }

      .qa-summary--attention {
        background: #fffbea;
        border-color: var(--warning-main);
        color: #5b4e1b;
      }

      .qa-summary--reject {
        background: #f8d7da;
        border-color: var(--danger-main);
        color: #721c24;
      }

      .qa-issues {
        font-size: 0.8rem;
        margin-bottom: 10px;
      }

      .qa-issues ul {
        padding-left: 18px;
        margin: 4px 0 0;
      }

      .qa-issues li {
        margin-bottom: 2px;
      }

      .per-class-table {
        margin-top: 8px;
        font-size: 0.8rem;
        border-radius: 10px;
        overflow: hidden;
        border: 1px solid rgba(0, 0, 0, 0.08);
        background: #fafafa;
      }

      .per-class-row {
        display: grid;
        grid-template-columns: 2fr 1fr;
        padding: 7px 10px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.04);
      }

      .per-class-row.header {
        font-weight: 600;
        background: #f3f4f6;
      }

      .per-class-row:last-child {
        border-bottom: none;
      }

      .plot-wrapper {
        margin-top: 12px;
        border-radius: 10px;
        border: 1px solid rgba(0, 0, 0, 0.08);
        background: #f9fafb;
        padding: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .plot-img {
        width: 100%;
        height: auto;
        max-height: 520px;
        border-radius: 6px;
        display: block;
      }

      .empty-state {
        font-size: 0.82rem;
        color: var(--neutral-text-secondary);
        text-align: center;
        padding: 36px 8px;
      }

      footer {
        max-width: 1120px;
        margin: 0 auto 14px;
        padding: 0 16px;
        font-size: 0.7rem;
        color: var(--neutral-text-secondary);
      }

      code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        font-size: 0.72rem;
        padding: 2px 6px;
        border-radius: 999px;
        background: #f3f4f6;
        border: 1px solid rgba(148, 163, 184, 0.6);
        color: #4b1580;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-inner">
        <div class="header-left">
          <div class="logo-pill">IF</div>
          <div>
            <div class="header-title">IFOTOM QA – Cuvette Segmentation</div>
            <div class="header-subtitle">
              Avaliação visual de cubetas: cuvette, líquido e bolhas via YOLO.
            </div>
          </div>
        </div>

      </div>
    </header>

    <main>
      <div class="layout">
        <!-- UPLOAD -->
        <section class="card">
          <h2>1. Enviar imagem da cubeta</h2>
          <p>
            Selecione uma imagem (JPG, PNG ou HEIC) da cubeta. O modelo irá segmentar
            cuvette, líquido, bolhas e artefatos para avaliação de qualidade.
          </p>

          <form method="post" action="/" enctype="multipart/form-data" class="form-group">
            <label class="file-drop">
              <span class="title">Clique para escolher a imagem</span>
              <span class="hint">
                ou arraste um arquivo até aqui. Use uma foto focada na região da cubeta.
              </span>
              <input
                type="file"
                name="file"
                accept="image/*"
                onchange="document.getElementById('file-name').textContent = this.files[0] ? this.files[0].name : 'Nenhum arquivo selecionado';"
              />
            </label>

            <div id="file-name" class="selected-file">
              Nenhum arquivo selecionado
            </div>

            <button type="submit" class="btn">Analisar imagem</button>
          </form>

          {% if error %}
          <div class="error-box">
            {{ error }}
          </div>
          {% endif %}
        </section>

        <!-- RESULTADO -->
        <section class="card">
          <h2>2. Resultado da análise de qualidade</h2>
          <p>
            Veja o resumo automático da qualidade da imagem, problemas detectados
            e a recomendação para uso ou recaptura.
          </p>

          {% if result %}
          <div class="result-header">
            Arquivo analisado: <strong>{{ result.filename }}</strong>
          </div>

          {% if result.qa %}
          <div class="qa-summary qa-summary--{{ result.qa.score }}">
            <div class="qa-summary-title">
              {{ result.qa.summary }}
            </div>
            <div>
              {{ result.qa.recommendation }}
            </div>
          </div>

          {% if result.qa.issues %}
          <div class="qa-issues">
            <strong>Detalhes detectados:</strong>
            <ul>
              {% for issue in result.qa.issues %}
              <li>{{ issue }}</li>
              {% endfor %}
            </ul>
          </div>
          {% endif %}
          {% endif %}

          <div class="per-class-table">
            <div class="per-class-row header">
              <div>Classe</div>
              <div>Instâncias</div>
            </div>
            {% for cls in result.per_class %}
            <div class="per-class-row">
              <div>{{ cls.name }}</div>
              <div>{{ cls.count }}</div>
            </div>
            {% endfor %}
          </div>

          <div class="plot-wrapper">
            <img
              src="data:image/png;base64,{{ result.plot_base64 }}"
              alt="Imagem anotada pelo modelo"
              class="plot-img"
            />
          </div>

          {% else %}
          <div class="empty-state">
            Nenhuma análise realizada ainda.<br />
            Envie uma imagem ao lado e clique em <strong>Analisar imagem</strong>.
          </div>
          {% endif %}
        </section>
      </div>
    </main>

    <footer>
      <p>
        Para contato:
        <code>lucasbiazonpalma@gmail.com</code>, 
    </footer>
  </body>
</html>
